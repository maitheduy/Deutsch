<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªçc Ng·ªØ Ph√°p Ti·∫øng ƒê·ª©c - ƒê·ªông T·ª´ "Sein" (Tr√°o Ng·∫´u Nhi√™n)</title>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(135deg, #a8e6cf, #dcedc1);
      margin: 0;
      padding: 20px;
      text-align: center;
      color: #333;
    }

    h1 {
      color: #e91e63;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      font-size: 3rem;
    }

    .container {
      max-width: 900px;
      margin: 20px auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .audio-btn {
      background: #ff9800;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 50px;
      font-size: 1.2rem;
      cursor: pointer;
      margin: 15px 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .word-bank {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      padding: 15px;
      background: #f0f8ff;
      border-radius: 15px;
    }

    .word {
      padding: 12px 18px;
      background: #4fc3f7;
      color: white;
      border-radius: 12px;
      font-weight: bold;
      cursor: grab;
      user-select: none;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }

    .word:active {
      cursor: grabbing;
      transform: scale(1.1);
    }

    .sentence-area {
      margin: 30px 0;
      padding: 20px;
      background: #fff3e0;
      border-radius: 15px;
      min-height: 80px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      position: relative;
    }

    .placeholder {
      width: 80px;
      height: 50px;
      background: #ffebee;
      border: 2px dashed #ff5722;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #757575;
    }

    .correct {
      background: #c8e6c9 !important;
      border: 2px solid #4caf50;
    }

    .wrong {
      background: #ffcdd2 !important;
      border: 2px solid #f44336;
    }

    .feedback {
      font-size: 1.5rem;
      margin: 20px 0;
      font-weight: bold;
      min-height: 60px;
      color: #d81b60;
    }

    .grammar-table {
      margin: 30px auto;
      border-collapse: collapse;
      background: #e3f2fd;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .grammar-table td, .grammar-table th {
      padding: 12px 15px;
      text-align: center;
      border: 1px solid #bbdefb;
    }

    .grammar-table th {
      background: #4fc3f7;
      color: white;
      font-weight: bold;
    }

    .grammar-table tr:nth-child(even) {
      background: #e3f2fd;
    }

    .success-sound, .error-sound {
      display: none;
    }

    .btn-next {
      background: #673ab7;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 50px;
      font-size: 1.2rem;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .emoji {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    @media (max-width: 600px) {
      h1 { font-size: 2rem; }
      .word { padding: 10px 15px; font-size: 0.9rem; }
      .placeholder { width: 60px; height: 40px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéâ H·ªçc ƒê·ªông T·ª´ "Sein" C√πng M√®o D·ªÖ Th∆∞∆°ng!</h1>

    <button class="audio-btn" id="play-first">üîä Ph√°t √¢m c√¢u ƒë·∫ßu ti√™n: "Ich bin m√ºde."</button>

    <div class="emoji">üê±</div>
    <p style="font-size: 1.3rem;">K√©o nh·ªØng t·ª´ b√™n d∆∞·ªõi ƒë·ªÉ t·∫°o th√†nh c√¢u ƒë√∫ng nh√©!<br><em>(C√°c t·ª´ ƒë√£ b·ªã x√°o tr·ªôn ‚Äì h√£y s·∫Øp x·∫øp ƒë√∫ng!)</em></p>

    <div class="word-bank" id="word-bank"></div>

    <div class="sentence-area" id="sentence-area"></div>

    <div class="feedback" id="feedback"></div>

    <table class="grammar-table">
      <thead>
        <tr>
          <th>Ch·ªß ng·ªØ</th><th>ƒê·ªông t·ª´</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>ich</td><td>bin</td></tr>
        <tr><td>du</td><td>bist</td></tr>
        <tr><td>er</td><td>ist</td></tr>
        <tr><td>sie</td><td>ist</td></tr>
        <tr><td>es</td><td>ist</td></tr>
        <tr><td>wir</td><td>sind</td></tr>
        <tr><td>ihr</td><td>seid</td></tr>
        <tr><td>sie</td><td>sind</td></tr>
        <tr><td>Sie</td><td>sind</td></tr>
      </tbody>
    </table>

    <button class="btn-next" id="next-btn" disabled>Ti·∫øp theo ‚ûú</button>
  </div>

  <!-- √Çm thanh -->
  <audio id="success-sound" class="success-sound">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-up-score-achievement-bling-210.mp3" type="audio/mp3">
  </audio>
  <audio id="error-sound" class="error-sound">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" type="audio/mp3">
  </audio>

  <script>
    // C√¢u c·∫ßn s·∫Øp x·∫øp (b·∫£n g·ªëc - th·ª© t·ª± ƒë√∫ng)
    const sentences = [
      ["Ich", "bin", "m√ºde."],
      ["Du", "bist", "klug."],
      ["Er", "ist", "in", "der", "Schule."],
      ["Wir", "sind", "Freunde."],
      ["Ihr", "seid", "schnell."],
      ["Sie", "sind", "aus", "Vietnam."]
    ];

    // G·ª£i √Ω n·∫øu sai
    const hints = [
      "H√£y nh·ªõ: Ich + bin",
      "Du + bist - gi·ªëng nh∆∞ 'b·∫°n l√†'",
      "Er + ist + ƒë·ªãa ƒëi·ªÉm",
      "Wir + sind + b·∫°n b√®",
      "Ihr + seid + nhanh",
      "Sie (h·ªç) + sind + xu·∫•t x·ª©"
    ];

    // M·∫£ng ch·ª©a t·∫•t c·∫£ c√°c t·ª´ c√≥ th·ªÉ d√πng (d√πng ƒë·ªÉ t·∫°o word bank)
    const allWords = [
      "Ich", "bin", "m√ºde.", "Du", "bist", "klug.", "Er", "ist", "in", "der", "Schule.", 
      "Wir", "sind", "Freunde.", "Ihr", "seid", "schnell.", "Sie", "aus", "Vietnam."
    ];

    let currentSentenceIndex = 0;

    // H√†m tr√°o ng·∫´u nhi√™n m·∫£ng (Fisher-Yates shuffle)
    function shuffleArray(array) {
      const shuffled = [...array]; // b·∫£n sao
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    // Kh·ªüi t·∫°o giao di·ªán cho c√¢u hi·ªán t·∫°i
    function init() {
      const wordBank = document.getElementById('word-bank');
      const sentenceArea = document.getElementById('sentence-area');
      const feedback = document.getElementById('feedback');

      // X√≥a c≈©
      wordBank.innerHTML = '';
      sentenceArea.innerHTML = '';
      feedback.textContent = '';

      const originalSentence = sentences[currentSentenceIndex]; // Th·ª© t·ª± ƒë√∫ng
      const shuffledSentence = shuffleArray(originalSentence);   // Th·ª© t·ª± tr√°o

      // Th√™m c√°c t·ª´ v√†o word bank (ch√≠nh l√† t·ª´ trong c√¢u, tr√°o ng·∫´u nhi√™n)
      shuffledSentence.forEach(word => {
        const div = document.createElement('div');
        div.className = 'word';
        div.textContent = word;
        div.draggable = true;
        div.dataset.word = word;
        wordBank.appendChild(div);

        div.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', word);
          e.dataTransfer.effectAllowed = 'move';
        });
      });

      // T·∫°o c√°c √¥ placeholder theo th·ª© t·ª± TR√ÅO (ƒë·ªÉ h·ªçc sinh k√©o v√†o)
      shuffledSentence.forEach((_, index) => {
        const placeholder = document.createElement('div');
        placeholder.className = 'placeholder';
        placeholder.dataset.index = index; // V·ªã tr√≠ trong m·∫£ng tr√°o
        placeholder.dataset.originalIndex = index; // Kh√¥ng d√πng ƒë·ªÉ ki·ªÉm tra
        placeholder.addEventListener('dragover', (e) => {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'move';
        });
        placeholder.addEventListener('drop', handleDrop);
        sentenceArea.appendChild(placeholder);
      });

      // L∆∞u b·∫£n g·ªëc ƒë·ªÉ ki·ªÉm tra sau n√†y
      window.currentOriginalSentence = originalSentence;
      window.currentShuffledSentence = shuffledSentence;

      // N·∫øu l√† c√¢u ƒë·∫ßu ti√™n, t·ª± ƒë·ªông ph√°t √¢m
      if (currentSentenceIndex === 0) {
        speakText(originalSentence.join(' '));
      }
    }

    // X·ª≠ l√Ω khi th·∫£ t·ª´ v√†o √¥
    function handleDrop(e) {
      e.preventDefault();
      const word = e.dataTransfer.getData('text/plain');
      const placeholder = e.target;

      // Ki·ªÉm tra: t·ª´ n√†y c√≥ n·∫±m trong c√¢u ƒë√∫ng kh√¥ng?
      const originalSentence = window.currentOriginalSentence;
      const shuffledSentence = window.currentShuffledSentence;

      // T√¨m v·ªã tr√≠ ƒë√∫ng c·ªßa t·ª´ trong c√¢u g·ªëc
      const correctIndexInOriginal = originalSentence.indexOf(word);
      if (correctIndexInOriginal === -1) return; // Kh√¥ng h·ª£p l·ªá

      // T√¨m v·ªã tr√≠ hi·ªán t·∫°i c·ªßa placeholder trong m·∫£ng tr√°o
      const placeholderIndex = Array.from(placeholder.parentNode.children).indexOf(placeholder);
      const wordAtThisPosition = shuffledSentence[placeholderIndex];

      // ‚úÖ ƒê√öNG: n·∫øu t·ª´ v·ª´a th·∫£ v√†o ƒë√∫ng v·ªã tr√≠ c·ªßa n√≥ trong C√ÇU G·ªêC
      // Nghƒ©a l√†: t·ª´ "Ich" ph·∫£i n·∫±m ·ªü v·ªã tr√≠ 0 trong c√¢u g·ªëc, b·∫•t k·ªÉ n√≥ ƒëang ·ªü ƒë√¢u tr√™n m√†n h√¨nh
      if (originalSentence.indexOf(word) === placeholderIndex) {
        // ƒê√¢y l√† v·ªã tr√≠ ƒë√∫ng trong c√¢u g·ªëc!
        placeholder.textContent = word;
        placeholder.classList.add('correct');
        placeholder.draggable = false;

        // Ki·ªÉm tra xem ƒë√£ ho√†n th√†nh ch∆∞a? T·∫•t c·∫£ √¥ ƒë·ªÅu c√≥ t·ª´?
        const allFilled = Array.from(placeholder.parentNode.children).every(p => p.textContent !== '');
        if (allFilled) {
          playSound('success');
          document.getElementById('feedback').textContent = '‚ú® Ch√∫c m·ª´ng! B·∫°n ƒë√£ l√†m r·∫•t t·ªët! üéâ';
          document.getElementById('next-btn').disabled = false;
        }
      } else {
        // ‚ùå SAI: t·ª´ n√†y kh√¥ng n·∫±m ·ªü v·ªã tr√≠ ƒë√∫ng trong c√¢u g·ªëc
        playSound('error');
        document.getElementById('feedback').textContent = `Sai r·ªìi! G·ª£i √Ω: ${hints[currentSentenceIndex]}.\nƒê√°p √°n ƒë√∫ng: "${originalSentence.join(' ')}"`;
        placeholder.style.animation = 'shake 0.5s';
        setTimeout(() => {
          placeholder.style.animation = '';
        }, 500);
      }
    }

    // Ph√°t √¢m b·∫±ng Google TTS
    function speakText(text) {
      const url = `https://translate.google.com/translate_tts?ie=UTF-8&tl=de&q=${encodeURIComponent(text)}&client=tw-ob`;
      const audio = new Audio(url);
      audio.play().catch(e => console.log("TTS b·ªã ch·∫∑n:", e));
    }

    // Ph√°t √¢m √¢m thanh
    function playSound(type) {
      const sound = document.getElementById(type + '-sound');
      sound.currentTime = 0;
      sound.play().catch(e => console.log("Kh√¥ng ph√°t ƒë∆∞·ª£c √¢m thanh:", e));
    }

    // N√∫t "Ti·∫øp theo"
    document.getElementById('next-btn').addEventListener('click', () => {
      if (currentSentenceIndex < sentences.length - 1) {
        currentSentenceIndex++;
        init();
        document.getElementById('next-btn').disabled = true;
        document.getElementById('feedback').textContent = '';
      } else {
        document.getElementById('feedback').textContent = 'üéâ B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c c√¢u! Tuy·ªát v·ªùi! üëè';
        document.getElementById('next-btn').disabled = true;
      }
    });

    // N√∫t ph√°t √¢m c√¢u ƒë·∫ßu
    document.getElementById('play-first').addEventListener('click', () => {
      speakText(sentences[0].join(' '));
    });

    // Kh·ªüi ch·∫°y
    init();
  </script>
</body>
</html>
